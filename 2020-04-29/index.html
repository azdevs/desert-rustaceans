<!DOCTYPE html>
<html lang="en">
    <head>
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta http-equiv="content-type" content="text/html; charset=utf-8">

      <!-- Enable responsiveness on mobile devices-->
      <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

      <title>Desert Rust - GraphQL and OAuth</title>

      
        <link rel="alternate" type="application/rss+xml" title="RSS" href="https:&#x2F;&#x2F;azdevs.github.io&#x2F;desert-rustaceans&#x2F;rss.xml">
      

      
          <script src="https://cdnjs.cloudflare.com/ajax/libs/slideout/1.0.1/slideout.min.js"></script>
          
      

      
          <link rel="stylesheet" href="https:&#x2F;&#x2F;azdevs.github.io&#x2F;desert-rustaceans&#x2F;site.css">
          
      

      
      
    </head>

    <body>
        <div class="container">

            <div id="mobile-navbar" class="mobile-navbar">
              <div class="mobile-header-logo">
                <a href="/" class="logo">Desert Rust</a>
              </div>
              <div class="mobile-navbar-icon icon-out">
                <span></span>
                <span></span>
                <span></span>
              </div>
            </div>

            <nav id="mobile-menu" class="mobile-menu slideout-menu slideout-menu-left">
              <ul class="mobile-menu-list">
                
                    <li class="mobile-menu-item">
                        <a href="https:&#x2F;&#x2F;azdevs.github.io&#x2F;desert-rustaceans">
                            Home
                        </a>
                    </li>
                
                    <li class="mobile-menu-item">
                        <a href="https:&#x2F;&#x2F;azdevs.github.io&#x2F;desert-rustaceans&#x2F;tags">
                            Topics
                        </a>
                    </li>
                
                    <li class="mobile-menu-item">
                        <a href="https:&#x2F;&#x2F;www.meetup.com&#x2F;Desert-Rustaceans&#x2F;">
                            Meetup
                        </a>
                    </li>
                
                    <li class="mobile-menu-item">
                        <a href="https:&#x2F;&#x2F;discord.gg&#x2F;6SNb2daz">
                            PHX Tech Council Discord #rust
                        </a>
                    </li>
                
                    <li class="mobile-menu-item">
                        <a href="https:&#x2F;&#x2F;github.com&#x2F;azdevs&#x2F;desert-rustaceans">
                            Github
                        </a>
                    </li>
                
              </ul>
            </nav>

            <header id="header">
                <div class="logo"><a href="https:&#x2F;&#x2F;azdevs.github.io&#x2F;desert-rustaceans">Desert Rust</a></div>
                <nav class="menu">
                    <ul>
                        
                            <li>
                                <a href="https:&#x2F;&#x2F;azdevs.github.io&#x2F;desert-rustaceans">
                                    Home
                                </a>
                            </li>
                        
                            <li>
                                <a href="https:&#x2F;&#x2F;azdevs.github.io&#x2F;desert-rustaceans&#x2F;tags">
                                    Topics
                                </a>
                            </li>
                        
                            <li>
                                <a href="https:&#x2F;&#x2F;www.meetup.com&#x2F;Desert-Rustaceans&#x2F;">
                                    Meetup
                                </a>
                            </li>
                        
                            <li>
                                <a href="https:&#x2F;&#x2F;discord.gg&#x2F;6SNb2daz">
                                    PHX Tech Council Discord #rust
                                </a>
                            </li>
                        
                            <li>
                                <a href="https:&#x2F;&#x2F;github.com&#x2F;azdevs&#x2F;desert-rustaceans">
                                    Github
                                </a>
                            </li>
                        
                    </ul>
                </nav>
            </header>

            <main>
                <div class="content" id="mobile-panel">
                    


<div class="post-toc" id="post-toc">
    <h2 class="post-toc-title">Contents</h2>
    <div class="post-toc-content always-active">
        <nav id="TableOfContents">
            <ul>
                
                <li>
                    <a href="https://azdevs.github.io/desert-rustaceans/2020-04-29/#graphql-server-using-via-blainebublitz" class="toc-link">GraphQL Server using via @BlaineBublitz</a>
                    
                </li>
                
                <li>
                    <a href="https://azdevs.github.io/desert-rustaceans/2020-04-29/#attempting-to-implement-oauth2-dance-with-rocket-via-danielpbank" class="toc-link">Attempting to Implement OAuth2 Dance with Rocket via @DanielPBank</a>
                    
                </li>
                
                <li>
                    <a href="https://azdevs.github.io/desert-rustaceans/2020-04-29/#crates-you-should-know" class="toc-link">Crates You Should Know</a>
                    
                </li>
                
            </ul>
        </nav>
    </div>
</div>


<article class="post">
    
    <header class="post__header">
        <h1 class="post__title">
            <a href="https:&#x2F;&#x2F;azdevs.github.io&#x2F;desert-rustaceans&#x2F;2020-04-29&#x2F;">GraphQL and OAuth</a>
        </h1>
        <div class="post__meta">
            <span class="post__time">2020-04-29</span>
            
        </div>
    </header>

    <div class="post-content">
      <p>Topics:</p>
<ul>
<li>GraphQL Server using via <a href="https://github.com/phated">@BlaineBublitz</a></li>
<li>Attempting to Implement OAuth2 Dance with Rocket via <a href="https://github.com/danielbank">@DanielPBank</a></li>
</ul>
<p id="zola-continue-reading"><a name="continue-reading"></a></p>
<h1 id="graphql-server-using-via-blainebublitz">GraphQL Server using via <a href="https://github.com/phated">@BlaineBublitz</a></h1>
<p><a href="https://graphql.org/">GraphQL</a> Server implemented with <a href="https://github.com/seanmonstar/warp">Warp</a>, <a href="https://github.com/diesel-rs/diesel">Diesel</a> and <a href="https://github.com/async-graphql/async-graphql">async-graphql</a></p>
<p>Repo: <a href="https://github.com/phated/twentyfive-stars">https://github.com/phated/twentyfive-stars</a></p>
<ul>
<li>
<p>This project uses <a href="https://crates.io/crates/warp">warp</a> as a web framework, but Blaine thinks [tide](tide = &quot;0.8.0&quot;) is pretty cool. Tide is designed more for usability than performance and uses <a href="https://crates.io/crates/async-std">async-std</a> as its async runtime.</p>
</li>
<li>
<p>Blaine was originally using <a href="https://crates.io/crates/juniper">juniper</a> as a GraphQL server library, but several factors made developing with it painful: slow movement on async, lack of <a href="https://relay.dev/">Relay</a> support, etc. It caused him to put the project on hold.</p>
</li>
<li>
<p>Recently switched to using <a href="https://crates.io/crates/async-graphql">async-graphql</a> and it has been a significant improvement. Async-graphql is a two-month old project and already has built-in Relay support, support for GraphQL subscriptions, uses procedural macros to provide GraphQL schema by default, has solid examples, and the maintainer responds very quickly to issues.</p>
</li>
<li>
<p>We can annotate GraphQL interfaces with an interface macro. For instance, you can add an <code>id</code> field to multiple structs with one macro. With field annotation, it exports everything that isn't hidden which is nice.</p>
</li>
<li>
<p>With async-graphql, there's ongoing discussion about whether the GraphQL Interfaces should be typechecked (they currently are). The alternative would be a panic on server startup. However, it takes a long time to start the server so you don't want to wait only to find out that you made a mistake.</p>
</li>
<li>
<p>Rust Traits map pretty well to GraphQL Interfaces, there was an issue about supporting interface implementation based on trait (the async-graphql maintainer responded to it during the presentation).</p>
</li>
</ul>
<h1 id="attempting-to-implement-oauth2-dance-with-rocket-via-danielpbank">Attempting to Implement OAuth2 Dance with Rocket via <a href="https://github.com/danielbank">@DanielPBank</a></h1>
<p>Trying to implement the <a href="https://tools.ietf.org/html/rfc6749">OAuth2 dance</a> using the <a href="https://rocket.rs">Rocket Web Framework</a> and the <a href="https://crates.io/crates/oauth2">oauth2</a> library.</p>
<p>Repo: <a href="https://github.com/danielbank/rust-oauth-rocket">https://github.com/danielbank/rust-oauth-rocket</a></p>
<ul>
<li>
<p><a href="https://github.com/danielbank/rust-oauth-rocket/commits/step1">Step 1</a>: We start with the Google OAuth2 example code from the <a href="https://crates.io/crates/oauth2">oauth2</a> library. The example creates an authorization URL that we can navigate to for requesting access the user's calendar and basic profile information using scopes. Afterwards, we are redirected back to our local server code which then uses a baked-in <a href="https://github.com/seanmonstar/reqwest">reqwest http_client</a> to communicate with Google's Authorization Server for exchanging a received AuthCode for an access token.</p>
</li>
<li>
<p><a href="https://github.com/danielbank/rust-oauth-rocket/tree/step2">Step 2</a>: Basic Hello World Rocket example</p>
</li>
<li>
<p><a href="https://github.com/danielbank/rust-oauth-rocket/tree/step3">Step 3</a>: Expanding on the Rocket example to include static assets. We need to bring in <a href="https://crates.io/crates/rocket_contrib">rocket_contrib</a> to do this.</p>
</li>
<li>
<p><a href="https://github.com/danielbank/rust-oauth-rocket/tree/step4">Step 4</a>: Now we have the static assets and the skeleton of an OAuth callback route which receives <code>code</code> and <code>state</code> as query string parameters and prints them out.</p>
</li>
<li>
<p><a href="https://github.com/danielbank/rust-oauth-rocket/tree/step5">Step 5</a>: Now we implement the same OAuth2 Google example. In our main function we create the Oauth2 client and share it to two routes using <a href="https://docs.rs/rocket/0.4.2/rocket/struct.State.html">State</a>. The first route (<code>/oauth/authorize</code>) creates the authorization url and redirects to it. The second route (<code>/oauth/callback</code>) handles the redirect back from Google and exchanging the authcode for a token. <strong>THIS IS STILL NOT SECURE</strong>: we need to compare the <code>csrf_state.secret()</code> that we get when creating the authorization url in <code>/oauth/authorize</code> with the <code>state.secret()</code> that we get back from Google in our <code>/oauth/callback</code>. To maintain this information across requests, we need to store it in some sort of a session. I was working on implementing this but ran out of time before the meetup.</p>
</li>
</ul>
<h1 id="crates-you-should-know">Crates You Should Know</h1>
<ul>
<li><a href="https://crates.io/crates/async-graphql">async-graphql</a>: A GraphQL server library implemented in Rust</li>
<li><a href="https://crates.io/crates/smol">smol</a>: A small and fast async runtime</li>
<li><a href="https://crates.io/crates/oauth2">oauth2</a>: An extensible, strongly-typed implementation of OAuth2</li>
<li><a href="https://crates.io/crates/rocket">rocket</a>: Web framework for nightly with a focus on ease-of-use, expressibility, and speed.</li>
<li><a href="https://crates.io/crates/rocket_contrib">rocket_contrib</a>: Community contributed libraries for the Rocket web framework.</li>
</ul>

    </div>

    
    

    <div class="post-footer">
        
            
                <div class="post-tags">
                    
                        <a href="https:&#x2F;&#x2F;azdevs.github.io&#x2F;desert-rustaceans&#x2F;tags&#x2F;web&#x2F;">#Web</a>
                    
                        <a href="https:&#x2F;&#x2F;azdevs.github.io&#x2F;desert-rustaceans&#x2F;tags&#x2F;server&#x2F;">#Server</a>
                    
                </div>
            
            
                <div class="post-nav">
                    
                        <a class="previous" href="https:&#x2F;&#x2F;azdevs.github.io&#x2F;desert-rustaceans&#x2F;2020-02-26&#x2F;">‹ Embedded and Performance</a>
                    
                    
                        <a class="next" href="https:&#x2F;&#x2F;azdevs.github.io&#x2F;desert-rustaceans&#x2F;2020-05-27&#x2F;">sqlx and WASM in React ›</a>
                    
                    
                    
                </div>
            

        

    </div>

    
    
</article>


                </div>
            </main>

            
            
        </div>

      
          <script type="text/javascript" src="https:&#x2F;&#x2F;azdevs.github.io&#x2F;desert-rustaceans&#x2F;even.js" ></script>
      
    </body>

</html>
